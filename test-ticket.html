<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Management - AI Contact Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        :root {
            --primary: #0d6efd;
            --secondary: #6c757d;
            --success: #198754;
            --info: #0dcaf0;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #212529;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .stats-card {
            text-align: center;
            padding: 20px 15px;
            border-radius: 12px;
            color: white;
            transition: transform 0.3s;
        }

            .stats-card:hover {
                transform: translateY(-5px);
            }

        .stats-1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stats-2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stats-3 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stats-4 {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .ticket-item {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

            .ticket-item:hover {
                background: rgba(13, 110, 253, 0.05);
            }

            .ticket-item.active {
                background: rgba(13, 110, 253, 0.1);
                border-left-color: var(--primary);
            }

        .ticket-priority-high {
            border-left-color: var(--danger);
        }

        .ticket-priority-medium {
            border-left-color: var(--warning);
        }

        .ticket-priority-low {
            border-left-color: var(--success);
        }

        .sentiment-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .sentiment-positive {
            background-color: var(--success);
        }

        .sentiment-negative {
            background-color: var(--danger);
        }

        .sentiment-neutral {
            background-color: var(--warning);
        }

        .conversation-timeline {
            position: relative;
            padding-left: 30px;
        }

            .conversation-timeline::before {
                content: '';
                position: absolute;
                left: 15px;
                top: 0;
                bottom: 0;
                width: 2px;
                background: #e9ecef;
            }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

            .timeline-item::before {
                content: '';
                position: absolute;
                left: -23px;
                top: 5px;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: var(--primary);
            }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 85%;
            position: relative;
        }

        .customer-message {
            background: #f1f3f4;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }

        .agent-message {
            background: #e3f2fd;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .ai-suggestion {
            background: #fff3cd;
            border: 1px dashed #ffeaa7;
            margin: 10px auto;
            font-style: italic;
        }

        .agent-process {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

            .agent-process.active {
                background: #e8f4fd;
                border-left: 4px solid var(--info);
            }

            .agent-process.completed {
                background: #d1f2eb;
                border-left: 4px solid var(--success);
            }

        .compact-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }

        .section-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .ai-response-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 12px;
            padding: 16px;
            border-left: 4px solid var(--info);
        }

        .quick-action-btn {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

            .quick-action-btn:hover {
                transform: translateY(-2px);
            }

        .ticket-meta {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .avatar-sm {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-3">
        <!-- Header -->
        <div class="row mb-3">
            <div class="col">
                <h4 class="section-title mb-0">
                    <i class="fas fa-ticket-alt me-2 text-primary"></i>
                    Ticket Management
                </h4>
                <p class="text-muted mb-0">AI-powered customer support with conversation history</p>
            </div>
            <div class="col-auto">
                <button class="btn btn-primary btn-sm">
                    <i class="fas fa-plus me-1"></i>New Ticket
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row g-3 mb-4">
            <div class="col-xl-3 col-md-6">
                <div class="stats-card stats-1">
                    <i class="fas fa-inbox fa-lg mb-2"></i>
                    <h5 class="mb-1">24</h5>
                    <p class="mb-0 small">Open Tickets</p>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="stats-card stats-2">
                    <i class="fas fa-clock fa-lg mb-2"></i>
                    <h5 class="mb-1">2.1h</h5>
                    <p class="mb-0 small">Avg. Response</p>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="stats-card stats-3">
                    <i class="fas fa-user-check fa-lg mb-2"></i>
                    <h5 class="mb-1">87%</h5>
                    <p class="mb-0 small">First Contact</p>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="stats-card stats-4">
                    <i class="fas fa-robot fa-lg mb-2"></i>
                    <h5 class="mb-1">63%</h5>
                    <p class="mb-0 small">AI Resolution</p>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <!-- Ticket List -->
            <div class="col-xl-4 col-lg-5">
                <div class="glass-card">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Ticket Queue</h6>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-filter me-1"></i>Filter
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">All Tickets</a></li>
                                    <li><a class="dropdown-item" href="#">Open Only</a></li>
                                    <li><a class="dropdown-item" href="#">High Priority</a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="ticket-list">
                            <!-- Ticket Items -->
                            <div class="ticket-item active" data-ticket="78901">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">#78901 - Product Issue</h6>
                                        <p class="ticket-meta mb-1">John Smith • 15 min ago</p>
                                    </div>
                                    <span class="badge bg-danger compact-badge">High</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-warning compact-badge">In Progress</span>
                                    <div>
                                        <span class="sentiment-indicator sentiment-negative"></span>
                                        <small class="text-muted">Frustrated</small>
                                    </div>
                                </div>
                            </div>

                            <div class="ticket-item" data-ticket="78900">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">#78900 - Billing Query</h6>
                                        <p class="ticket-meta mb-1">Sarah Johnson • 2 hours ago</p>
                                    </div>
                                    <span class="badge bg-warning compact-badge">Medium</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-success compact-badge">Resolved</span>
                                    <div>
                                        <span class="sentiment-indicator sentiment-positive"></span>
                                        <small class="text-muted">Satisfied</small>
                                    </div>
                                </div>
                            </div>

                            <div class="ticket-item" data-ticket="78899">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">#78899 - Return Request</h6>
                                        <p class="ticket-meta mb-1">Mike Davis • 3 hours ago</p>
                                    </div>
                                    <span class="badge bg-secondary compact-badge">Low</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-primary compact-badge">Open</span>
                                    <div>
                                        <span class="sentiment-indicator sentiment-neutral"></span>
                                        <small class="text-muted">Neutral</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ticket Details -->
            <div class="col-xl-8 col-lg-7">
                <div class="glass-card">
                    <div class="card-body p-3">
                        <!-- Ticket Header -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h5 class="mb-1">#78901 - Product not working after update</h5>
                                <div class="ticket-meta">
                                    <span class="me-3"><i class="fas fa-user me-1"></i>John Smith</span>
                                    <span class="me-3"><i class="fas fa-clock me-1"></i>15 minutes ago</span>
                                    <span><i class="fas fa-tag me-1"></i>Technical Support</span>
                                </div>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-danger me-1">High Priority</span>
                                <span class="badge bg-warning">In Progress</span>
                            </div>
                        </div>

                        <!-- Conversation Timeline -->
                        <div class="conversation-timeline mb-4">
                            <h6 class="section-title">Conversation History</h6>

                            <!-- Initial Customer Message -->
                            <div class="timeline-item">
                                <div class="message-bubble customer-message">
                                    <div class="d-flex align-items-center mb-2">
                                        <img src="https://ui-avatars.com/api/?name=John+Smith&background=0D8ABC&color=fff" class="avatar-sm me-2">
                                        <div>
                                            <strong>John Smith</strong>
                                            <div class="ticket-meta">Today, 10:15 AM</div>
                                        </div>
                                    </div>
                                    <p class="mb-0">Hello, I'm very frustrated because my product stopped working after the latest update. I've tried restarting and reinstalling but nothing works. This is affecting my business operations and I need immediate assistance.</p>
                                </div>
                            </div>

                            <!-- AI Processing -->
                            <div class="timeline-item">
                                <div class="message-bubble ai-suggestion">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-robot text-warning me-2"></i>
                                        <strong>AI Assistant</strong>
                                        <div class="ticket-meta ms-2">Processing...</div>
                                    </div>
                                    <p class="mb-0">Analyzing customer issue and generating response...</p>
                                </div>
                            </div>

                            <!-- AI Generated Response -->
                            <div class="timeline-item">
                                <div class="message-bubble agent-message">
                                    <div class="d-flex align-items-center mb-2">
                                        <img src="https://ui-avatars.com/api/?name=AI+Assistant&background=00A86B&color=fff" class="avatar-sm me-2">
                                        <div>
                                            <strong>AI Assistant</strong>
                                            <div class="ticket-meta">Today, 10:16 AM • AI Generated</div>
                                        </div>
                                    </div>
                                    <div class="ai-response-box mb-2">
                                        <p class="mb-2">I understand your frustration with the product issue after the recent update. I've identified this as a known compatibility issue that our team is actively addressing.</p>
                                        <p class="mb-2">As an immediate solution, I recommend rolling back to version 2.4.3 which you can download from our support portal.</p>
                                        <p class="mb-0">I've also initiated expedited support to ensure this is resolved within 24 hours.</p>
                                    </div>
                                    <div class="ticket-meta">
                                        <i class="fas fa-check-circle text-success me-1"></i>
                                        Response sent to customer
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Follow-up -->
                            <div class="timeline-item">
                                <div class="message-bubble customer-message">
                                    <div class="d-flex align-items-center mb-2">
                                        <img src="https://ui-avatars.com/api/?name=John+Smith&background=0D8ABC&color=fff" class="avatar-sm me-2">
                                        <div>
                                            <strong>John Smith</strong>
                                            <div class="ticket-meta">Today, 10:45 AM</div>
                                        </div>
                                    </div>
                                    <p class="mb-0">Thanks for the response. I tried rolling back but I'm still having issues. The product crashes immediately after launch. Can you help me with this?</p>
                                </div>
                            </div>
                        </div>

                        <!-- AI Processing for Follow-up -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="section-title mb-0">AI Processing - Follow-up</h6>
                                <button id="process-followup" class="btn btn-primary btn-sm">
                                    <i class="fas fa-robot me-1"></i>Process Follow-up
                                </button>
                            </div>

                            <div id="followup-workflow">
                                <div class="agent-process" data-agent="context">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-sync-alt text-warning me-2"></i>
                                        <div class="flex-grow-1">
                                            <small class="fw-bold">Context Analysis</small>
                                            <div class="ticket-meta">Reviewing previous interactions</div>
                                        </div>
                                        <span class="badge bg-secondary compact-badge">Pending</span>
                                    </div>
                                </div>
                                <div class="agent-process" data-agent="diagnosis">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-stethoscope text-info me-2"></i>
                                        <div class="flex-grow-1">
                                            <small class="fw-bold">Advanced Diagnosis</small>
                                            <div class="ticket-meta">Analyzing crash patterns</div>
                                        </div>
                                        <span class="badge bg-secondary compact-badge">Pending</span>
                                    </div>
                                </div>
                                <div class="agent-process" data-agent="solution">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-lightbulb text-warning me-2"></i>
                                        <div class="flex-grow-1">
                                            <small class="fw-bold">Solution Generation</small>
                                            <div class="ticket-meta">Creating alternative solution</div>
                                        </div>
                                        <span class="badge bg-secondary compact-badge">Pending</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- New AI Response -->
                        <div id="followup-response" style="display: none;">
                            <h6 class="section-title">AI Response to Follow-up</h6>
                            <div class="ai-response-box mb-3">
                                <p class="mb-2">I understand the rollback didn't resolve the issue. Let me provide an alternative solution:</p>
                                <p class="mb-2">1. Please try clearing the application cache from Settings > Storage > Clear Cache</p>
                                <p class="mb-2">2. If that doesn't work, download the special patch file from this link: [Patch Download]</p>
                                <p class="mb-0">3. I've also escalated this to our technical team for immediate attention</p>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-sm">
                                    <i class="fas fa-paper-plane me-1"></i>Send Response
                                </button>
                                <button class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-edit me-1"></i>Modify
                                </button>
                                <button class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-phone me-1"></i>Call Customer
                                </button>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="border-top pt-3">
                            <h6 class="section-title">Quick Actions</h6>
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-outline-primary quick-action-btn">
                                    <i class="fas fa-comment me-1"></i>Add Note
                                </button>
                                <button class="btn btn-outline-secondary quick-action-btn">
                                    <i class="fas fa-user me-1"></i>Assign to Me
                                </button>
                                <button class="btn btn-outline-warning quick-action-btn">
                                    <i class="fas fa-flag me-1"></i>Escalate
                                </button>
                                <button class="btn btn-outline-success quick-action-btn">
                                    <i class="fas fa-check me-1"></i>Resolve
                                </button>
                                <button class="btn btn-outline-info quick-action-btn">
                                    <i class="fas fa-history me-1"></i>View History
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Ticket selection
            $('.ticket-item').click(function () {
                $('.ticket-item').removeClass('active');
                $(this).addClass('active');

                const ticketId = $(this).data('ticket');
                console.log('Loading ticket:', ticketId);

                // Reset AI processing when switching tickets
                resetAIProcessing();
            });

            // Follow-up AI Processing
            $('#process-followup').click(function () {
                const agents = [
                    { agent: 'context', delay: 1000 },
                    { agent: 'diagnosis', delay: 2500 },
                    { agent: 'solution', delay: 4000 }
                ];

                // Reset all agents first
                $('.agent-process').removeClass('active completed');
                $('.agent-process .badge').removeClass('bg-success bg-warning').addClass('bg-secondary').text('Pending');

                // Process each agent with delay
                agents.forEach((agentInfo, index) => {
                    setTimeout(() => {
                        const agentElement = $(`.agent-process[data-agent="${agentInfo.agent}"]`);
                        agentElement.removeClass('active').addClass('completed');
                        agentElement.find('.badge').removeClass('bg-secondary').addClass('bg-success').text('Completed');

                        // Show final response after last agent
                        if (index === agents.length - 1) {
                            setTimeout(() => {
                                $('#followup-response').slideDown();
                                // Add new AI response to timeline
                                addToTimeline();
                            }, 500);
                        }
                    }, agentInfo.delay);

                    // Show active state
                    setTimeout(() => {
                        $(`.agent-process[data-agent="${agentInfo.agent}"]`).addClass('active');
                        $(`.agent-process[data-agent="${agentInfo.agent}"] .badge`).removeClass('bg-secondary').addClass('bg-warning').text('Processing');
                    }, agentInfo.delay - 500);
                });
            });

            function resetAIProcessing() {
                $('.agent-process').removeClass('active completed');
                $('.agent-process .badge').removeClass('bg-success bg-warning').addClass('bg-secondary').text('Pending');
                $('#followup-response').hide();
            }

            function addToTimeline() {
                const timeline = $('.conversation-timeline');
                const newResponse = `
                        <div class="timeline-item">
                            <div class="message-bubble agent-message">
                                <div class="d-flex align-items-center mb-2">
                                    <img src="https://ui-avatars.com/api/?name=AI+Assistant&background=00A86B&color=fff" class="avatar-sm me-2">
                                    <div>
                                        <strong>AI Assistant</strong>
                                        <div class="ticket-meta">Just now • AI Generated</div>
                                    </div>
                                </div>
                                <div class="ai-response-box mb-2">
                                    <p class="mb-2">I understand the rollback didn't resolve the issue. Let me provide an alternative solution:</p>
                                    <p class="mb-2">1. Please try clearing the application cache from Settings > Storage > Clear Cache</p>
                                    <p class="mb-2">2. If that doesn't work, download the special patch file from this link: [Patch Download]</p>
                                    <p class="mb-0">3. I've also escalated this to our technical team for immediate attention</p>
                                </div>
                                <div class="ticket-meta">
                                    <i class="fas fa-clock text-warning me-1"></i>
                                    Ready to send
                                </div>
                            </div>
                        </div>
                    `;

                // Add before the quick actions section
                timeline.append(newResponse);
            }

            // Send Response
            $('.btn-success').click(function () {
                alert('Response sent successfully!');
                // Update status in timeline
                $('.conversation-timeline .timeline-item:last .fa-clock')
                    .removeClass('fa-clock text-warning')
                    .addClass('fa-check-circle text-success')
                    .next()
                    .text('Response sent to customer');
            });
        });
    </script>
</body>
</html>